<%= content_for(:title, '在沉默中爆发 | ^轩^') %>
<%= render :partial=> 'shared/carousel_picture' %>
<div class="container">
  <div class="grid">
    <div class="programa">
      <div class="side">
        <span><img src="<%= image_url('toutu/video.png') %>" style="width: 20px;height: 16px;padding-bottom: 5px"></span>
        <%= @videos.total_entries %> 个视频</p>
      </div>
      <div class="programa-list">
        <ul>
          <% Column.hexie.shunxu.each do |channel| %>
              <li><a href="<%= video_channel_path(channel.english) %>"><i class="<%= channel.icon %>"></i>&nbsp;&nbsp;<%= channel.name %></a></li>
          <% end %>
          <% if current_user && current_user.can_av? && Column.find_by_english('Fucking')%>
              <% channel = Column.find_by_english('Fucking') %>
              <li><a href="<%= video_channel_path(channel.english) %>"><i class="<%= channel.icon %>"></i>&nbsp;&nbsp;<%= channel.name %></a></li>
          <% end %>
        </ul>
      </div>
    </div>
    <div class="video">
      <ul class="video-list">
        <% cache [:index, @videos.map{|c| c['updated_at']}.max] do%>
            <%= render :partial=> 'shared/more_videos', locals: {videos:@videos} %>
        <% end %>
      </ul>
    </div>
    <div class="more">
      <a class="load-more" href="javascript:void(0)" onclick="load_index_more(2,<%= @videos.total_entries - 9%>)">
        <h4>MORE 「 <%= @videos.total_entries - 9 > 0 ? @videos.total_entries - 9:'+ _ +'%> 」</h4>
      </a>
    </div>
  </div>
</div>
<script>
    function load_index_more(page,total){
        var num = parseInt(page) + 1;
        if(parseInt(total) > 8){
            var local = parseInt(total) - 9;
        }else{
            var local = total;
        }
        $.get('/videos/get_index_more',{page: page}, function(data){
            console.log(data);
            if(data ==''){
                $('.load-more').html('<h4>感谢您对我们视频的支持！(+ _ +) </h4>').removeAttr('onclick');
            }else{
                $('.load-more').attr('onclick',"load_index_more ("+ num +","+ local +")");
                $('.load-more').html("<h4>MORE「 "+ local + "」</h4>");
                $('.video-list').append(data);
            }
        })
    }
</script>